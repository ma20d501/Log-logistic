# ============================================================
#              ***  JEL for log-logistic distribution (JEL)
#*                    #Author: Avhad Ganesh Vishnu  
# ============================================================
rm(list=ls())
library(LaplacesDemon)
library(VGAM)
library(flexsurv)
library(stats)
library(VaRES)
library(emplik)
# ===============================

# ===============================
gls <- function(n, DistNum) {
  
  if (DistNum == 1)      X <- rllogis(n, 0.5, 1)
  else if (DistNum == 2) X <- rllogis(n, 1, 1)
  else if (DistNum == 3) X <- rllogis(n, 2, 1)
  else if (DistNum == 4) X <- rllogis(n, 5, 1)
  
  else if (DistNum == 5) X <- rloglap(n, location.ald = 0, scale.ald = 1,
                                      kappa = sqrt(0.5/(1-0.5)))
  else if (DistNum == 6) X <- rloglap(n, location.ald = 2, scale.ald = 1,
                                      kappa = sqrt(0.5/(1-0.5)))
  
  else if (DistNum == 7) X <- exp(rt(n, 2))
  else if (DistNum == 8) X <- exp(rt(n, 3))
  else if (DistNum == 9) X <- exp(rt(n, 5))
  
  else if (DistNum == 10) X <- rlnorm(n, 0, 1)
  else if (DistNum == 11) X <- rlnorm(n, 1, 1)
  else if (DistNum == 12) X <- rlnorm(n, 3, 2)
  
  else if (DistNum == 13) X <- rgamma(n, 1, 2)
  else if (DistNum == 14) X <- rgamma(n, 2, 0.5)
  else if (DistNum == 15) X <- rgamma(n, 0.5, 1)
  
  else if (DistNum == 16) X <- rweibull(n, 1, 0.5)
  else if (DistNum == 17) X <- rweibull(n, 0.5, 1)
  else if (DistNum == 18) X <- rweibull(n, 1, 1.5)
  
  else if (DistNum == 19) X <- rinvgamma(n, 1, 2)
  else if (DistNum == 20) X <- rinvgamma(n, 2, 0.5)
  else if (DistNum == 21) X <- rinvgamma(n, 0.5, 1.5)
  
  else if (DistNum == 22) X <- rpareto(n, 1, 1)
  else if (DistNum == 23) X <- rpareto(n, 1.5, 1)
  
  else if (DistNum == 24) X <- rchisq(n, 2)
  else if (DistNum == 25) X <- rchisq(n, 3)
  
  else stop("Invalid DistNum")
  
  return(X)
}

# ===============================
# Simulation Settings
# ===============================
MC      <- 1000
samples <- c(25,50)
crit    <- 3.84
DistSet <- 1:25

results <- array(NA, dim = c(length(DistSet), length(samples)),
                 dimnames = list(paste0("Dist", DistSet),
                                 paste0("n=", samples)))

# ===============================
# ===============================
for (DistNum in DistSet) {
  
  for (s in seq_along(samples)) {
    
    n   <- samples[s]
    Jkn <- numeric(MC)
    
    k1  <- 1 / choose(n, 3)
    k11 <- 1 / choose(n - 1, 3)
    
    for (r in 1:MC) {
      
      x  <- gls(n, DistNum)
      xs <- sort(x)
      
      # ===== Test statistic (UNCHANGED) =====
      s1 <- 0
      for(i in 1:(n-2))
        for(j in (i+1):(n-1))
          for(k in (j+1):n)
            s1 <- s1 + (xs[k]/max(xs[i],xs[j]))*(max(xs[i],xs[j])>xs[k])
      delta1 <- k1*s1
      
      s1 <- 0
      for(i in 1:(n-2))
        for(j in (i+1):(n-1))
          for(k in (j+1):n)
            s1 <- s1 + (xs[j]/max(xs[i],xs[k]))*(max(xs[i],xs[k])>xs[j])
      delta2 <- k1*s1
      
      s1 <- 0
      for(i in 1:(n-2))
        for(j in (i+1):(n-1))
          for(k in (j+1):n)
            s1 <- s1 + (xs[i]/max(xs[k],xs[j]))*(max(xs[k],xs[j])>xs[i])
      delta3 <- k1*s1
      
      t <- (delta1 + delta2 + delta3)/3 - 1/6
      
      v  <- numeric(n)
      tl <- numeric(n)
      
      for (m in 1:n) {
        
        xs1 <- sort(x[-m])
        s11 <- 0
        for(i in 1:(n-3))
          for(j in (i+1):(n-2))
            for(k in (j+1):(n-1))
              s11 <- s11 + (xs1[k]/max(xs1[i],xs1[j]))*(max(xs1[i],xs1[j])>xs1[k])
        delta11 <- k11*s11
        
        s11 <- 0
        for(i in 1:(n-3))
          for(j in (i+1):(n-2))
            for(k in (j+1):(n-1))
              s11 <- s11 + (xs1[j]/max(xs1[i],xs1[k]))*(max(xs1[i],xs1[k])>xs1[j])
        delta12 <- k11*s11
        
        s11 <- 0
        for(i in 1:(n-3))
          for(j in (i+1):(n-2))
            for(k in (j+1):(n-1))
              s11 <- s11 + (xs1[i]/max(xs1[k],xs1[j]))*(max(xs1[k],xs1[j])>xs1[i])
        delta13 <- k11*s11
        
        tl[m] <- (delta11 + delta12 + delta13)/3 - 1/6
        v[m]  <- n*t - (n-1)*tl[m]
      }
      
      Jkn[r] <- el.test(v, mu = 0)$`-2LLR`
    }
    
    results[DistNum, s] <- mean(Jkn > crit, na.rm = TRUE)
  }
}

results
